<!-- 
    @author:  zZZ....
    @description:
    @date: 2022/5/24
-->
    <title>zZZ.... | 看看概况吧~ </title>



    <div class="page-wrapper" >
    <div class="container-xl">

        <div class="page-header d-print-none">
            <div class="row align-items-center">
                <div class="col">

                    <h2 class="page-title">
                        站点概况
                    </h2>
                </div>


            </div>
        </div>
    </div>
    <div class="page-body">
        <div class="container-xl">
            <div class="row row-deck row-cards">
                <div class="col-lg-6">
                    <div class="row row-cards">
                        <div class="col-12">
                            <div class="card ">
                                <div class="card-body">
                                    <h3 class="card-title">流量地图</h3>
                                    <div class="ratio ratio-21x9" style="height: 291px">
                                        <div>
                                            <div id="map-world" class="w-100 h-100"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row z-ptu">
                                        <div class="col-sm-6 col-lg-6">
                                            <div class="card card-sm">
                                                <div class="card-body">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <span class="bg-blue text-white avatar">
                                                                PV
                                                            </span>
                                                        </div>
                                                        <div class="col">
                                                            <div class="font-weight-medium">
                                                                <span> 浏览量：</span>
                                                                <span  id="PV"> </span>
                                                            </div>

<!--                                                            <div class="text-muted">-->
<!--                                                                <span> 今日：</span>-->
<!--                                                                <span  id="PV_today"> </span>-->
<!--                                                            </div>-->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-lg-6">
                                            <div class="card card-sm">
                                                <div class="card-body">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <span class="bg-green text-white avatar">
                                                                TV
                                                            </span>
                                                        </div>
                                                        <div class="col">
                                                            <div class="font-weight-medium" >
                                                                <span> 访问量：</span>
                                                                <span  id="TV"> </span>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-lg-6">
                                            <div class="card card-sm">
                                                <div class="card-body">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <span class="bg-twitter text-white avatar" >
                                                                UV
                                                            </span>
                                                        </div>
                                                        <div class="col">
                                                            <div class="font-weight-medium" >
                                                                <span> 访问人数：</span>
                                                                <span  id="UV"> </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-lg-6">
                                            <div class="card card-sm">
                                                <div class="card-body">
                                                    <div class="row align-items-center">
                                                        <div class="col-auto">
                                                            <span class="bg-facebook text-white avatar">
                                                                WC
                                                            </span>
                                                        </div>
                                                        <div class="col">
                                                            <div class="font-weight-medium">
                                                                <span> 总字数：</span>
                                                                <span  id="WC"> </span> K

                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>

                </div>
                <div class="col-lg-6">
                    <div class="row row-cards">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <p class="mb-3">服务器硬件使用情况： <strong>6854.45 MB </strong></p>
                                    <div class="progress progress-separated mb-3">
                                        <div id="cpu_use"  data-toggle="tooltip"  class=" bg-primary" role="progressbar" style="width: 44%"></div>
                                        <div id="cpu_free"  data-toggle="tooltip"  class="progress-bar " role="progressbar" style="width: 9%;background-color: #c9d6df"></div>


                                        <div id="mem_use"  data-toggle="tooltip"  class=" bg-info" role="progressbar" style="width: 19%"></div>
                                        <div id="mem_free"  data-toggle="tooltip"  class="progress-bar " role="progressbar" style="width: 9%;background-color: #c9d6df"></div>

                                        <div id="disk_use"  data-toggle="tooltip"  class=" bg-success" role="progressbar" style="width: 19%"></div>
                                        <div id="disk_free"  data-toggle="tooltip"  class="progress-bar " role="progressbar" style="width: 9%;background-color: #c9d6df"></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-auto d-flex align-items-center pe-2">
                                            <span class="legend me-2 bg-primary"></span>
                                            <span>CPU</span>
                                            <span class="d-none d-md-inline d-lg-none d-xxl-inline ms-2 text-muted">4 core</span>
                                        </div>
                                        <div class="col-auto d-flex align-items-center px-2">
                                            <span class="legend me-2 bg-info"></span>
                                            <span>内存</span>
                                            <span class="d-none d-md-inline d-lg-none d-xxl-inline ms-2 text-muted">4G</span>
                                        </div>
                                        <div class="col-auto d-flex align-items-center px-2">
                                            <span class="legend me-2 bg-success"></span>
                                            <span>磁盘</span>
                                            <span class="d-none d-md-inline d-lg-none d-xxl-inline ms-2 text-muted">1.08T</span>
                                        </div>
                                        <div class="col-auto d-flex align-items-center ps-2">
                                            <span class="legend me-2" style="background-color: #c9d6df;"></span>
                                            <span>Free</span>
                                            <span class="d-none d-md-inline d-lg-none d-xxl-inline ms-2 text-muted">剩余百分比</span>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card" style="height: 28rem">
                                <div class="card-body card-body-scrollable card-body-scrollable-shadow">
                                    <div class="divide-y">
                                        <div>
                                            <div class="row">
                                                <div class="col-auto">
                                                    <span class="avatar">JL</span>
                                                </div>
                                                <div class="col">
                                                    <div class="text-truncate">
                                                        <strong>Jeffie Lewzey</strong> commented on your <strong>"I'm not a witch."</strong> post.
                                                    </div>
                                                    <div class="text-muted">yesterday</div>
                                                </div>
                                                <div class="col-auto align-self-center">
                                                    <div class="badge bg-primary"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 col-lg-8">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">页面访问情况</h3>
                        </div>
                        <div class="card-table table-responsive">
                            <table class="table table-vcenter">
                                <thead>
                                <tr>
                                    <th>uri</th>
                                    <th>访问量</th>
                                    <th colspan="2">访问占比</th>
                                </tr>
                                </thead>

                                <tbody id="uri">

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">客户端访问类型</h3>
                        </div>
                        <table class="table card-table table-vcenter">
                            <thead>
                            <tr>
                                <th>浏览器</th>
                                <th colspan="2">访问量</th>
                            </tr>
                            </thead>
                            <tbody id="browser">

                            <tr>
                                <td>Twitter</td>
                                <td>1,798</td>
                                <td class="w-50">
                                    <div class="progress progress-xs">
                                        <div class="progress-bar bg-primary" style="width: 35.96%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Facebook</td>
                                <td>1,245</td>
                                <td class="w-50">
                                    <div class="progress progress-xs">
                                        <div class="progress-bar bg-primary" style="width: 24.9%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>TikTok</td>
                                <td>986</td>
                                <td class="w-50">
                                    <div class="progress progress-xs">
                                        <div class="progress-bar bg-primary" style="width: 19.72%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Pinterest</td>
                                <td>854</td>
                                <td class="w-50">
                                    <div class="progress progress-xs">
                                        <div class="progress-bar bg-primary" style="width: 17.08%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>VK</td>
                                <td>650</td>
                                <td class="w-50">
                                    <div class="progress progress-xs">
                                        <div class="progress-bar bg-primary" style="width: 13.0%"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Pinterest</td>
                                <td>420</td>
                                <td class="w-50">
                                    <div class="progress progress-xs">
                                        <div class="progress-bar bg-primary" style="width: 8.4%"></div>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>





<script>


    $(function (e) {
        $.ajax({
            url:'/blogBlogs/pvMap',
            type:'get',
            success:function (res) {
                HomeMap = new jsVectorMap({
                    selector: '#map-world',
                    map:"china",
                    backgroundColor: 'transparent',
                    regionStyle: {
                        initial: {
                            fill: '#F8FAFC',
                            stroke: 'rgba(98, 105, 118, .16)',
                            strokeWidth: 1,
                        }
                    },
                    zoomOnScroll: false,
                    zoomButtons: false,
                    // -------- Series --------f
                    visualizeData: {
                        scale: ['#F8FAFC', '#206bc4'],
                        values:res.data
                    },
                });
            }
        });



        /*网站访问情况*/
        $.ajax({
            url:"/blogBlogs/ptu",
            type:"get",
            success:function (res) {
                if (res.success){
                    document.getElementById("PV").innerText = res.data.PV;
                    document.getElementById("TV").innerText = res.data.TV;
                    document.getElementById("UV").innerText = res.data.UV;
                    document.getElementById("WC").innerText = (res.data.WC/1000).toFixed(2);
                }
            }
        });

        /*服务器使用情况*/
        $.ajax({
            url:"/blogBlogs/sysMsg",
            type:"get",
            success:function (res) {
                if (res.success){
                    let cpu_use = $('#cpu_use');
                    let cpu_free = $('#cpu_free');
                    let mem_use = $('#mem_use');
                    let mem_free = $('#mem_free');
                    let disk_use = $('#disk_use');
                    let disk_free = $('#disk_free');

                    cpu_use.css("width",res.data.cpu_use+"%")  ;
                    cpu_free.css("width",res.data.cpu_free+"%")  ;
                    mem_use.css("width",res.data.mem_use+"%")  ;
                    mem_free.css("width",res.data.mem_free+"%")  ;
                    disk_use.css("width",res.data.disk_use+"%")  ;
                    disk_free.css("width",res.data.disk_free+"%")  ;

                    cpu_use.tooltip({
                        title:"cpu使用 "+res.data.cpu_use.toFixed(2)+"%"
                    });
                    cpu_free.tooltip({
                        title:"cpu空闲 "+res.data.cpu_free.toFixed(2)+"%"
                    });
                    mem_use.tooltip({
                        title:"内存占用 "+res.data.mem_use.toFixed(2)+"%"
                    });
                    mem_free.tooltip({
                        title:"内存空闲 "+res.data.mem_free.toFixed(2)+"%"
                    });
                    disk_use.tooltip({
                        title:"磁盘使用 "+res.data.disk_use.toFixed(2)+"%"
                    });
                    disk_free.tooltip({
                        title:"磁盘剩余 "+res.data.disk_free.toFixed(2)+"%"
                    });

                }
            }
        })

        /*新的消息*/
        $.ajax({
            url:"/GuestBookController/adminList",
            type:'post',
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            data:JSON.stringify({currentPage:0,pageSize:20,p:null}),
            success:function (res) {

                let lists =res.data.list;

                if (res.success && lists.length>0){
                    let arr= [];
                    for (let i =0;i<lists.length;i++){
                        let table = lists[i];
                        arr.push('<div <div class="row"><div class="col-auto"><span class="avatar" style="background-image: url(');
                        arr.push(table.headShot?table.headShot:'/medias/Anonymous.jpg');
                        arr.push( ')"></span> </div><div class="col"><div class="text-truncate">\n');
                        arr.push('<strong>');
                        arr.push(table.nickname);
                        arr.push('：</strong>');
                        arr.push(table.content);
                        arr.push('</div> <div class="text-muted">');
                        arr.push(table.createDate===new Date().toLocaleDateString()?'今天':table.createDate);
                        arr.push('</div></div><div class="col-auto align-self-center"> <div class="badge bg-primary"></div></div></div></div>');

                    }

                    window.requestAnimationFrame(function (e) {
                        $(".divide-y").html(arr.join(''))
                    });

                }
            }
        });

        //页面访问统计
        $.ajax({
            url:"/blogBlogs/uriAndBrowser",
            type:'post',
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            data:JSON.stringify({currentPage:0,pageSize:20,p:null}),
            success:function (res) {

                if (res.success && res.data.length>0){
                    let arr1= [];
                    let arr2= [];
                    for (let i =0;i<res.data.length;i++){
                        let table =(res.data)[i];
                        if (table.type==='uri'){
                            arr1.push('<tr><td>');
                            arr1.push(table.uc);
                            arr1.push('<a href="#" class="ms-1" aria-label="Open website"> <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" /><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" /></svg> </a> </td> <td class="text-muted">');
                            arr1.push(table.num);
                            arr1.push('</td><td class="text-muted">');
                            arr1.push(((table.num/res.code*100).toFixed(2))+'%');
                            arr1.push('</td> <td class="text-end w-1"><div class="chart-sparkline chart-sparkline-sm" id="sparkline-bounce-rate-1"></div> </td> </tr>')
                        }
                        if (table.type ==='browser'){

                            arr2.push('<tr><td>');
                            arr2.push(table.uc);
                            arr2.push( '</td><td>');
                            arr2.push( table.num);
                            arr2.push( '</td><td class="w-50"> <div class="progress progress-xs"><div class="progress-bar bg-primary" style="width: ');
                            arr1.push(((table.num/res.code)));
                            arr2.push( '"></div></div> </td> </tr>');
                        }
                    }

                    window.requestAnimationFrame(function (e) {
                        $("#uri").html(arr1.join(''))
                        $("#browser").html(arr2.join(''))
                    });

                }
            }
        })

    })



</script>
